<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Teacher Dashboard</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #f3f4f6;
        display: flex;
        height: 100vh;
        overflow: hidden;
      }

      /* Sidebar */
      .side-panel {
        width: 220px;
        background: #2c3e50;
        color: #fff;
        flex-shrink: 0;
        position: fixed;
        height: 100%;
        padding-top: 20px;
      }

      .side-panel a {
        display: block;
        padding: 12px 20px;
        text-decoration: none;
        color: #fff;
        margin-bottom: 5px;
        cursor: pointer;
      }

      .side-panel a:hover {
        background: #1abc9c;
      }

      /* Main content */
      .main-content {
        margin-left: 240px;
        flex: 1;
        padding: 20px;
        overflow-y: auto;
      }

      h2 {
        margin-top: 0;
        background: #1abc9c;
        color: white;
        padding: 10px;
        border-radius: 6px;
        width: max-content;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        background: white;
      }

      th,
      td {
        border: 1px solid #aaa;
        padding: 10px;
        text-align: left;
      }

      button {
        padding: 8px 16px;
        background: #1abc9c;
        color: white;
        border: none;
        cursor: pointer;
        border-radius: 4px;
        margin-top: 10px;
      }

      select,
      input,
      textarea {
        width: 100%;
        padding: 8px;
        margin-top: 5px;
        border-radius: 4px;
        border: 1px solid #ccc;
      }

      .section {
        display: none;
        margin-top: 20px;
        background: white;
        padding: 20px;
        border-radius: 8px;
      }

      .active-section {
        display: block;
      }
    </style>
  </head>
  <body>
    <!-- Sidebar -->
    <div class="side-panel">
      <h2>Teacher</h2>
      <a onclick="openTab('courses')">Assigned Courses</a>
      <a onclick="openTab('students')">View Students</a>
      <a onclick="openTab('attendance')">Mark Attendance</a>
      <a onclick="openTab('marks')">Add Marks</a>
      <a onclick="openTab('timetables')">View Timetables</a>
      <a onclick="openTab('notifications')">Send Notification</a>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Assigned Courses -->
      <div class="section active-section" id="courses">
        <h2>Assigned Courses</h2>
        <table>
          <tr>
            <th>ID</th>
            <th>Subject</th>
            <th>Class</th>
          </tr>
          {% for sub in assigned_subjects %}
          <tr>
            <td>{{ sub.id }}</td>
            <td>{{ sub.subject.subject_name }}</td>
            <td>
              {{ sub.assigned_class.class_name }} {{ sub.assigned_class.section
              }}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="3">No courses assigned.</td>
          </tr>
          {% endfor %}
        </table>
      </div>

      <!-- Students -->
      <div class="section" id="students">
        <h2>Student List</h2>
        <table>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Class</th>
          </tr>
          {% for std in students %}
          <tr>
            <td>{{ std.id }}</td>
            <td>{{ std.name }}</td>
            <td>{{ std.class_name }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="3">No students found.</td>
          </tr>
          {% endfor %}
        </table>
      </div>

      <!-- Mark Attendance -->
      <div class="section" id="attendance">
        <h2>Mark Attendance</h2>
        <form method="POST" action="{% url 'mark_attendance' %}">
          {% csrf_token %}
          <label>Select Subject</label>
          <select name="assign_id" required>
            <option disabled selected>Select</option>
            {% for a in assigned_subjects %}
            <option value="{{ a.id }}">
              {{ a.subject.subject_name }} - {{ a.assigned_class.class_name }}
            </option>
            {% endfor %}
          </select>

          <label>Select Student</label>
          <select name="student_id" required>
            {% for s in students %}
            <option value="{{ s.id }}">{{ s.name }}</option>
            {% endfor %}
          </select>

          <label>Status</label>
          <select name="status">
            <option value="Present">Present</option>
            <option value="Absent">Absent</option>
          </select>

          <button type="submit">Submit</button>
        </form>
      </div>

      <!-- Add Marks -->
      <div class="section" id="marks">
        <h2>Add Marks</h2>
        <form method="POST" action="{% url 'add_marks' %}">
          {% csrf_token %}
          <label>Select Subject</label>
          <select name="assign_id" required>
            {% for a in assigned_subjects %}
            <option value="{{ a.id }}">{{ a.subject.subject_name }}</option>
            {% endfor %}
          </select>

          <label>Select Student</label>
          <select name="student_id">
            {% for s in students %}
            <option value="{{ s.id }}">{{ s.name }}</option>
            {% endfor %}
          </select>

          <label>Marks</label>
          <input type="number" name="marks" required />

          <button type="submit">Save</button>
        </form>
      </div>

      <!-- Timetables -->
      <div class="section" id="timetables">
        <h2>Class Timetables</h2>
        <table>
          <tr>
            <th>ID</th>
            <th>Class</th>
            <th>File</th>
          </tr>
          {% for t in timetables %}
          <tr>
            <td>{{ t.id }}</td>
            <td>{{ t.class_room.class_name }} {{ t.class_room.section }}</td>
            <td>
              {% if t.timetable_file %}
              <a href="{{ t.timetable_file.url }}" target="_blank">View</a>
              {% else %} - {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="3">No timetables available.</td>
          </tr>
          {% endfor %}
        </table>
      </div>

      <!-- Notifications -->
      <div class="section" id="notifications">
        <h2>Send Notification to Admin</h2>
        <form method="POST" action="{% url 'send_notification' %}">
          {% csrf_token %}
          <label>Message</label>
          <textarea name="message" rows="3" required></textarea>
          <button type="submit">Send</button>
        </form>
        <h3>Sent Notifications</h3>
        <ul>
          {% for note in notifications %}
          <li>{{ note.created_at|date:"Y-m-d H:i" }} - {{ note.message }}</li>
          {% empty %}
          <li>No notifications sent yet.</li>
          {% endfor %}
        </ul>
      </div>
    </div>

    <script>
      function openTab(tabName) {
        document
          .querySelectorAll(".section")
          .forEach((s) => s.classList.remove("active-section"));
        document.getElementById(tabName).classList.add("active-section");
      }
    </script>
  </body>
</html>
